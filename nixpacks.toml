# Nixpacks configuration for MEC Backend
# Used for deployment on Railway, Render, and other nixpacks-compatible platforms
# Version: 1.5.0 - Full CORS fix + Swagger documentation
# Build timestamp: 2026-02-05T12:00:00Z

[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = ["npm i"]

[phases.build]
cmds = ["rm -rf dist", "npm run build"]

[start]
cmd = "node dist/server.js"

[variables]
NODE_ENV = "production"
NPM_CONFIG_PRODUCTION = "false"
CORS_ORIGIN = "https://mec.welocalhost.com,https://mecfoodapp.welocalhost.com,https://www.mecfoodapp.welocalhost.com,https://admin.mecfoodapp.welocalhost.com,https://meclife.welocalhost.com,https://www.meclife.welocalhost.com"
SOCKET_CORS_ORIGIN = "https://mec.welocalhost.com,https://mecfoodapp.welocalhost.com,https://www.mecfoodapp.welocalhost.com,https://admin.mecfoodapp.welocalhost.com,https://meclife.welocalhost.com,https://www.meclife.welocalhost.com"

# JWT Configuration (IMPORTANT: These must match what was used when users registered)
JWT_SECRET = "madrasone-jwt-secret-key-2024-production"
JWT_ACCESS_SECRET = "madrasone-access-token-secret-key-2024"
JWT_REFRESH_SECRET = "madrasone-refresh-token-secret-key-2024"
JWT_ISSUER = "mecfoodapp"
JWT_AUDIENCE = "mecfoodapp-users"

# MongoDB (set via deployment platform secrets for security)
# MONGODB_URI = "your-mongodb-uri"

# S3 Storage
GARAGE_ENDPOINT = "https://request.storage.mec.welocalhost.com"
GARAGE_BUCKET = "mecfoodmenu"
GARAGE_AVATAR_BUCKET = "mecavatars"
GARAGE_REGION = "garage"

# Image proxy base URL (used to convert Garage S3 URLs to proxy URLs)
API_BASE_URL = "https://backend.mec.welocalhost.com"
